<!DOCTYPE html>
<html xmlns:th="http://www.thymeLeaf.org" xmlns:sec="http://www.thymeLeaf.org/thymeLeaf-extras-springsecurity5">

<head>
    <meta charset="UTF-8">
    <title>Homepage</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css">
<link rel="stylesheet" th:href="@{/css/main.css}">


</head>

<body>
    <div th:replace="@{fragment/navbar}"></div>

    <div id="container" class="container text-center">
        <div>
        </div>
 

   


        <div class="title">
            <h1>posts</h1>
            <span sec:authorize="hasAnyAuthority('USER','MOD','ADMIN')">
                <a id="addpost" class="material-symbols-outlined" th:href="@{/create_post}">add</a>
            </span>
        </div>

        <div>
            <table>
                <thead >
                    <tr>
                        <th>Title</th>
                        <th>User</th>
                        <th>Category</th>
                        <th>Actions</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="post: ${listPosts}">
                        <td><a th:text="${post.Title}" target="_blank" /></td>

                        <td><a th:text="${post.username}" th:href="@{/user/{id}(id=${post.OP_id})}"></a></td>
                        <td th:text="${post.Category}"></td>

                        <td>
                            <a class="button button-outline" th:href="@{/post/{id}(id=${post.id})}">View</a>

                            <div sec:authorize="hasAnyAuthority('AUTH')">
                                <a class="button button-outline" th:href="@{/add_response/{id}(id=${post.id})}"> [Add Official Respone]</a>
                                <a class="button button-outline" th:href="@{/maresolved/{id}(id=${post.id})}">Mark as resolved</a>
                            </div>

                            <div sec:authorize="hasAnyAuthority('MOD','ADMIN')">
                                <a class="button button-outline" th:href="@{/delete/{id}(id=${post.id})}">Delete</a>
                            </div>
                            
                            <div th:switch="${user.id}">
                            <div th:case="${post.OP_id}"> <a class="button button-outline" th:href="@{/maresolvedOP/{id}(id=${post.id})}">Mark as resolved</a> </div>

                                
                            </div>
                            

                        </td>

                        <td>
                            <div th:switch="${post.Status}">
                                <span th:case="0">No Response</span>
                                <span th:case="1">In-Progress</span>
                                <a th:case="3"  th:inline='text' th:href="@{/user/{id}(id=${post.R_id})}">Post marked as resolved by [[${post.Resolver}]]</a>
                                <span th:case="2">Marked as resolved by OP</span>
                            </div>

                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
<df-messenger
  intent="WELCOME"
  chat-title="Chatbot"
  agent-id="8a72e87b-6281-432d-a25b-ccc530c044fa"
  language-code="en"
></df-messenger>
    </div>
</body>

</html>